{
  "orm": "Prisma v5",
  "provider": "postgresql (Supabase)",
  "clientGeneration": "src/generated/prisma/",
  "patterns": {
    "clientSingleton": "Prisma Client singleton exported from src/lib/db.ts following Next.js best practices (avoid multiple instances in serverless environments)",
    "migrations": "prisma/migrations/<timestamp>_init",
    "seeding": "(not yet implemented)"
  },
  "models": {
    "User": {
      "fields": ["id", "email", "name", "createdAt", "updatedAt"],
      "notes": "Users used for authentication and order ownership"
    },
    "Account": {
      "fields": [
        "id",
        "provider",
        "providerAccountId",
        "type",
        "userId",
        "encryptedCredentials",
        "createdAt",
        "updatedAt"
      ],
      "relations": ["user"],
      "notes": "Stores external account links and encrypted credentials (inventory accounts). Credentials encrypted using AES-256-GCM before persist. Accessed only on server and decrypted with server key."
    },
    "Product": {
      "fields": [
        "id",
        "title",
        "description",
        "price",
        "createdAt",
        "updatedAt"
      ],
      "relations": ["variants"]
    },
    "Variant": {
      "fields": ["id", "productId", "title", "sku", "price", "inventory"],
      "relations": ["product"]
    },
    "Order": {
      "fields": ["id", "userId", "status", "total", "createdAt", "updatedAt"],
      "relations": ["items", "user"],
      "statusEnum": "OrderStatus"
    },
    "OrderItem": {
      "fields": [
        "id",
        "orderId",
        "productId",
        "variantId",
        "quantity",
        "unitPrice"
      ],
      "relations": ["order", "product", "variant"]
    },
    "Transaction": {
      "fields": [
        "id",
        "orderId",
        "provider",
        "providerTransactionId",
        "amount",
        "currency",
        "status",
        "metadata",
        "createdAt",
        "updatedAt"
      ],
      "relations": ["order"],
      "notes": "Payment gateway transactions (Sepay). Used for reconciliation and idempotency checks."
    }
  },
  "enums": {
    "OrderStatus": [
      "PENDING",
      "PROCESSING",
      "FULFILLED",
      "SHIPPED",
      "DELIVERED",
      "CANCELLED"
    ]
  },
  "notes": [
    "Database layer updated with Account and Transaction models",
    "Account.encryptedCredentials stored via AES-256-GCM; server-side encryption/decryption helpers in files/services/encryption-service.json",
    "Transaction model added to track Sepay payments and reconcile order status"
  ]
}
